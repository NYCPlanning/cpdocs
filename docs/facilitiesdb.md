# Facilities Database
The Facilities Database (FacDB), a data product produced by the New York City (NYC) Department of City Planning (DCP) Capital Planning Division, captures the location, type, and capacity of public and private facilities ranging across six domains:

* Health Care and Human Services
* Youth, Education, and Child Welfare
* Public Safety, Emergency Services, and Administration of Justice
* Core Infrastructure and Transportation
* Parks, Cultural, and Other Community Facilities
* Administration of Government

This data resource provides agencies and communities with easy access to data and neighborhood context needed for site planning, assessing service delivery, preparing neighborhood plans, or informing capital investment decisions. The facilities and program sites are generally operated, funded, licensed, or certified by a City, State, or Federal government agency. 

Currently, FacDB aggregates and synthesizes data sourced from _ agencies, recording more than 31,000 facilities throughout NYC. A full listing of the facility types is provided in the Data Dictionary.

Historically, these records were updated only once per year. Beginning with this latest September _, 2016 release, the database is being produced using a revamped approach that relies heavily on automating the collection and transformation of data that agencies already publish. The process has been automated to pull from all available source datasets twice per month, so that the database will be as up-to-date as possible. 85% of the data sources are open datasets that agencies publish independently. 

### Overview
| General information |
| :------------: | ------------- |
| Name | |
| Description | The Facilities Database (FacDB) captures the locations and descriptions of public and private facilities ranging from the provision of social services, recreation, education, to solid waste management|
| Data format | GeoJSON, Shapefile, CSV |
| Projection | WGS84 |
| Date last updated | 09/12/16 |


## Database structure
Two tables compose FacDB:

* Facilities with Geolocations - Primary Table
* Facilities That Could Not Be Geocoded - 
* Relational tables....

Since most datasets did not include an identifying facility ID, the NEED TO FINISH

Additional information for certain facility types can be joined in using relational tables and the Global Unique Identifier.





## Data Dictionary

##### Facilities
| Field Alias | Field Name | Description |
| :------------------- | :------------------- | :------------------------------------------------------ |
| Global Unique Identifier | guid | Universal Unique Identifier.  When a row is added to the table the guid is automatically generated, enabling database replication. |
| ID | id | An alpha numeric unique identifier created and maintained by the database admin that is X number of characters long and a concatenation of A, B, and C. |
| Old ID | idold | Non-unique identifier generated and maintained by the former database admin that relates to old version of SFPSD. |
| Agency ID | idagency | Non-unique identifier generated and maintained by the data admin of the parent agency that relates to the record in the source dataset. |
| Facility Name | facilityname | The name of the facility in proper case. |
| Address Number | addressnumber | The address number of where the facility is located. Generated by GeoSupport when not provided in the source data. |
| Street Name | streetname | The name of the street where the facility is located. Generated by GeoSupport. |
| Address | address | The concatenated value of AddressNum and StreetName of where the facility is located. |
| City | city | The name of the addressed city where the facility is located. Generated by GeoSupport. |
| Borough | borough | The full name the borough the facility is within. |
| Borough Code | boroughcode | The number value representing the borough the facility is within. |
| ZIP Code | zipcode | The ZIP Code the facility is within. |
| BBL | bbl | The BBL(s) the facility is located on. |
| BIN | bin | The BIN(s) the facility is located on. |
| Park ID | parkid | The Park ID(s) associated with the facility. |
| X Coordinate | xcoord | The X coordinate of the location either calculated using the coordinates in the source data or provided by GeoSupport. |
| Y Coordinate | ycoord | The Y coordinate of the location either calculated using the coordinates in the source data or provided by GeoSupport. |
| Latitude | latitude | The latitude of the location either calculated using the coordinates in the source data or provided by GeoSupport. |
| Longitude | longitude | The longitude of the location either calculated using the coordinates in the source data or provided by GeoSupport. |
| Facility Type | facilitytype | The value representing the facility type, the most granular category of facilities. |
| Domain | domain | The value representing the facility domain, the broadest category. |
| Facility Group | facilitygroup | The value representing the group type, the second broadest category. |
| Facility Sub-Group | facilitysubgroup | The value representing the subgroup type. |
| Agency Classification 1 | agencyclass1 | The unmodified classification or descriptor of the facility record provided in the source data. Depending on the user's needs, these descriptors may provide additional details not captured in the Facility Type. |
| Agency Classification 2 | agencyclass2 | An additional unmodified classification or descriptor of the facility record provided in the source data. |
| COLP Primary Use Type | colpusetype | The Primary Use Type provided for the facility in the City Owned and Leased Properties (COLP) dataset. |
| Capacity | capacity | How many of capacity type/unit the facility is intended to hold. |
| Utilization | utilization | How many of capacity type/unit are being utilized at the facility. |
| Capacity Type | capacitytype | The value representing the unit type of capacity, such as beds, visitors, seats, etc. |
| Utilization Rate | utilizationrate | The ratio of the of utilization over the total facility capacity. |
| Area | area | The total area of the site measured in the Area Type unit. |
| Area Type | areatype | The unit of measurement for Area. |
| Service Area | servicearea | Indicates if the facility serves a regional or local population, which is determined by the Facility Type of facility according to Fair Share guidelines.  Value is calculated based on Facility Type. |
| Operator Type | operatortype | Indicates whether the operating entity is public or non-public. |
| Operator Name | operatorname | The name of the operating entity. |
| Operator Abbreviation | operatorabbrev | Abbreviation for the operating entity. |
| Oversight Agency | oversightagency | The name of the agency overseeing the facility. |
| Overight Abbreviation | oversightabbrev | Abbreviation for the oversight agency. |
| Date Active | dateactive | The date the facility became active in the database. |
| Date Inactive | dateinactive | The date the facility became inactive in the database. |
| Inactive Status | inactivestatus | The value indicating the status of the facility, whether it is in operation or not in operation.  Value is calculated based on DateInactive.  If DateInactive is not NULL then Status is Inactive. |
| Tags | tags | A series of tags classifying the facility. |
| Notes | notes | A space for the database admin to include any freestyle notes about the record. |
| Date Source Data Received | datesourcereceived | The date the source data was received from the parent agency. |
| Date Source Data Updated | datesourceupdated | The date the source data was updated within the parent database. |
| Date Created | datecreated | The date the record was created. |
| Date Edited | dateedited | The date the record was edited. |
| Creator | creator | The user who created the record. |
| Editor | editor | The user who last edited the record. |
| Geom | geom | How the feature is spatially represented. |
| Agency Source | agencysource | The Agency whose data was used as the source for the record. |
| Source Dataset Name | sourcedatasetname | The name of the dataset the record came from. |
| Link to Data | linkdata | Link to view and/or description of data. |
| Link to Direct Download | linkdownload | Link to directly download data. |
| Data Type | datatype | Format of the raw data received from the source. Examples: Shapefile, List of Addresses, or CSV with Coordinates. |
| Data Refresh Means | refreshmeans | The method for updating the records from this source dataset. |
| Data Refresh Frequency | refreshfrequency | The frequency of scheduled updates based on how frequently the source data is updated. |
| Building ID | buildingid | The ID of the building that the school is within. |
| Building Name | buildingname | The name of the school(s) within the building. |
| Organization Level | schoolorganizationlevel | The Organization Level of the school. |
| Children | children | Indicates if the facility serves children, which are persons that are 12 years old or younger. |
| Youth | youth | Indicates if the facility serves youth, which are persons that are 13 years old or less than 18 years old. |
| Seniors | senior | Indicates if the facility serves seniors, which are persons that are 65 years old or older. |
| Families | family | Indicates if the facility serves familes, which are groups of persons that span multiple age cohorts. |
| Disabilities | disabilities | Indicates if the facility serves persons with disabilities. |
| Dropouts | dropouts | Indicates if the facility serves dropouts. |
| Unemployed | unemployed | Indicates if the facility serves unemployed persons. |
| Homeless | homeless | Indicates if the facility serves homeless persons. |
| Immigrants | immigrants | Indicates if the facility serves immigrants. |
| Group Quarters | groupquarters | Indicates if the facility contains group living quarters. |


## Methodology

### Data Processing

Since all facility records are aggregated from many datasets designed for different purposes, the data has to undergo several stages of transformation to reach its final state. The stages are described below and all the scripts used are available on Github (LINK).

**Assembly.**
First, the desired columns in the source data get mapped to the columns in FacDB schema. Many values also need to be recoded and the facility records then need to be classified. The facilities are classified using categories or descriptions provided by the agency. In general, the final Facility Type categories in FacDB are formatted versions of the original classification provided by the agency, but there are also cases where the source description 

**Geoprocessing.**
Many records are provided with only addresses, no coordinates, and visa versa. Records without coordinates are geocoded using the address and either the Borough or ZIP Code to get the coordinates and the BIN and BBL. Records with only coordinates and no addresses are processed by doing a spatial join with MapPLUTO to get the BBL and then run the BBL through GeoClient to get the address and other location related details like Borough, ZIP Code, and BIN.

**Final Cleanup.**
A few final scipts are run at the end to recapitalize acronoyms, calculate and fill in remaining x, y coordinates, and exclude any facility records outside the NYC boundary.


### Source Data

The following datasets were used to populate the Facilities Database.

### Department of Design and Construction (DDC)
DDC is the City's primary capital construction manager; therefore, DDC centrally manages much of the Cityâ€™s capital projects portfolio.

##### Infrastructure projects
|               |                                    |
| --------------------------------- | ------------------------------------------------------- |
| Name | DDC Capital Projects Infrastructure Projects |
| Description | Line shapefile capturing past, present, and planned infrastructure project, primarily capturing DOT and DEP projects | 
| Agency | DDC |
| Data Format | Shapefile |
| Update Frequency | Weekly |
| Update Means | Weekly data exchange with DDC |
| Date Updated | 2/19/2016 |
| Date Received | 2/22/2016 |
| Notes | This dataset acts as the primary data source; therefore, if other datasets have the same project CPDB rejects duplicate records from other data sources | 

##### Public buildings projects
|               |                                    |
| --------------------------------- | ------------------------------------------------------- |
| Name | DDC Capital Projects Public Buildings |
| Description | Point shapefile capturing past, present, and planned public buildings projects | 
| Agency | DDC | 
| Data Format | Shapefile |
| Update Frequency | Weekly |
| Update Means | Weekly data exchange with DDC |
| Date Updated | 2/19/2016 |
| Date Received | 2/22/2016 |
| Notes | This dataset acts as the primary data source; therefore, if other datasets have the same project CPDB rejects duplicate records from other data sources | 

### REMEMBER TO INSERT DATA SOURCES FOR RECORDS MIGRATED FROM SFPSD!

### New York City Administration for Childrens Services (NYCACS)

	-- datesourcereceived
	'2016-07-20',
	-- datesourceupdated
	'2016-07-20',
	-- datecreated
	'2016-07-20',
	-- dateedited
	'2016-07-20',
	-- agencysource
	'NYCACS',
	-- sourcedatasetname
	'Contractor Data',
	-- linkdata
	'NA',
	-- linkdownload
	'NA',
	-- datatype
	'CSV with Coordinates',
	-- refreshmeans
	'Request file from agency',
	-- refreshfrequency
	'Annually',

### New York City Business Integrity Commission (NYCBIC)

	-- datesourcereceived
	'2016-07-01',
	-- datesourceupdated
	'2014-09-05',
	-- datecreated
	'2016-08-01',
	-- dateedited
	'2016-08-01',
	-- agencysource
	'NYCBIC',
	-- sourcedatasetname
	'Approved licensees and registrants for trade waste',
	-- linkdata
	'https://data.cityofnewyork.us/Business/Approved-licensees/7atx-5a3s',
	-- linkdownload
	'https://data.cityofnewyork.us/api/views/7atx-5a3s/rows.csv?accessType=DOWNLOAD',
	-- datatype
	'CSV with Coordinates',
	-- refreshmeans
	'Pull from NYC Open Data',
	-- refreshfrequency
	'Nightly pull',

### New York City Department of Consumer Affairs (NYCDCA)

	-- datesourcereceived
	'2016-08-01',
	-- datesourceupdated
	'2016-06-24',
	-- datecreated
	'2016-08-01',
	-- dateedited
	'2016-08-01',
	-- agencysource
	'NYCDCA',
	-- sourcedatasetname
	'Legally Operating Businesses',
	-- linkdata
	'https://data.cityofnewyork.us/Business/Legally-Operating-Businesses/w7w3-xahh',
	-- linkdownload
	'https://data.cityofnewyork.us/api/views/w7w3-xahh/rows.csv?accessType=DOWNLOAD',
	-- datatype
	'CSV with Address',
	-- refreshmeans
	'Geocode - Pull from NYC Open Data',
	-- refreshfrequency
	'Nightly pull',

### Fire Department of New York (NYCFDNY)

	-- datesourcereceived
	'2016-08-20',
	-- datesourceupdated
	'2016-08-20',
	-- datecreated
	'2016-09-01',
	-- dateedited
	'2016-09-01',
	-- agencysource
	'NYCDCAS',
	-- sourcedatasetname
	'Gazetteer 2016',
	-- linkdata
	'NA',
	-- linkdownload
	'NA',
	-- datatype
	'CSV with Address',
	-- refreshmeans
	'Geocode - Request from Agency',
	-- refreshfrequency
	'Annually',

### New York Police Department (NYCNYPD)

	-- datesourcereceived
	'2016-08-20',
	-- datesourceupdated
	'2016-08-20',
	-- datecreated
	'2016-09-01',
	-- dateedited
	'2016-09-01',
	-- agencysource
	'NYCDCAS',
	-- sourcedatasetname
	'Gazetteer 2016',
	-- linkdata
	'NA',
	-- linkdownload
	'NA',
	-- datatype
	'CSV with Address',
	-- refreshmeans
	'Geocode - Request from Agency',
	-- refreshfrequency
	'Annually',

### New York City Department of Cultural Affairs (NYCDCLA)

	-- datesourcereceived
	'2016-08-01',
	-- datesourceupdated
	'2016-03-22',
	-- datecreated
	'2016-08-01',
	-- dateedited
	'2016-08-01',
	-- agencysource
	'NYCDCLA',
	-- sourcedatasetname
	'DCLA Cultural Organizations',
	-- linkdata
	'https://data.cityofnewyork.us/Recreation/DCLA-Cultural-Organizations/u35m-9t32',
	-- linkdownload
	'https://data.cityofnewyork.us/api/views/u35m-9t32/rows.csv?accessType=DOWNLOAD',
	-- datatype
	'CSV with Address',
	-- refreshmeans
	'Geocode - Pull from NYC Open Data',
	-- refreshfrequency
	'Nightly pull',

### New York City Department for the Aging (NYCDFTA)

	-- datesourcereceived
	'2016-08-01',
	-- datesourceupdated
	'2016-07-15',
	-- datecreated
	'2016-08-01',
	-- dateedited
	'2016-08-01',
	-- agencysource
	'NYCDFTA',
	-- sourcedatasetname
	'DFTA Contracts',
	-- linkdata
	'https://data.cityofnewyork.us/Social-Services/DFTA-Contracts/6j6t-3ixh',
	-- linkdownload
	'https://data.cityofnewyork.us/api/views/6j6t-3ixh/rows.csv?accessType=DOWNLOAD',
	-- datatype
	'CSV with Address',
	-- refreshmeans
	'Geocode - Pull from NYC Open Data',
	-- refreshfrequency
	'Weekly',

### New York City Department of Education (NYCDOE)

	-- datesourcereceived
	'2016-08-01',
	-- datesourceupdated
	'2016-08-01',
	-- datecreated
	'2016-08-01',
	-- dateedited
	'2016-08-01',
	-- agencysource
	'NYCDOE',
	-- sourcedatasetname
	'Routes',
	-- linkdata
	'https://data.cityofnewyork.us/Transportation/Routes/8yac-vygm',
	-- linkdownload
	'https://data.cityofnewyork.us/api/views/8yac-vygm/rows.csv?accessType=DOWNLOAD',
	-- datatype
	'CSV with Coordinates',
	-- refreshmeans
	'Pull from NYC Open Data',
	-- refreshfrequency
	'Monthly',



